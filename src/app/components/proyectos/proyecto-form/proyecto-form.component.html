<div class="form-container">
  <div class="form-header">
    <div class="form-icon-wrapper">
      <svg class="form-icon" width="60" height="60" viewBox="0 0 100 100">
        <polygon points="50,10 75,30 75,50 50,90 25,50 25,30" fill="#8B1538" stroke="#000" stroke-width="3"/>
        <polygon points="50,10 75,30 75,50 50,90" fill="#A01B42" opacity="0.9"/>
        <polygon points="50,10 25,30 25,50 50,90" fill="#ffffff" opacity="0.95"/>
        <polygon points="50,25 65,40 65,50 50,75" fill="#ffffff" opacity="0.9"/>
        <polygon points="50,25 35,40 35,50 50,75" fill="#8B1538"/>
        <circle cx="50" cy="50" r="12" fill="#1a1d29" stroke="#8B1538" stroke-width="2"/>
        <circle cx="50" cy="50" r="6" fill="#8B1538"/>
      </svg>
      <svg class="project-icon" width="40" height="40" viewBox="0 0 20 20" fill="currentColor">
        <path d="M3 4a1 1 0 011-1h12a1 1 0 011 1v2a1 1 0 01-1 1H4a1 1 0 01-1-1V4zM3 10a1 1 0 011-1h6a1 1 0 011 1v6a1 1 0 01-1 1H4a1 1 0 01-1-1v-6zM14 9a1 1 0 00-1 1v6a1 1 0 001 1h2a1 1 0 001-1v-6a1 1 0 00-1-1h-2z"/>
      </svg>
    </div>
    <h1>{{ isEdit ? 'Editar Proyecto' : 'Nuevo Proyecto' }}</h1>
    <p>Complete la información del proyecto</p>
  </div>

  <form (ngSubmit)="onSubmit()" class="proyecto-form">
    <div class="form-group">
      <label for="titulo">Título del Proyecto </label>
      <input
        type="text"
        id="titulo"
        [(ngModel)]="proyecto.titulo"
        name="titulo"
        placeholder="Ingrese el título del proyecto"
        [disabled]="isLoading"
        (input)="onTituloInput($event)"
        required
      />
    </div>

    <div class="form-group">
      <label for="descripcion">Descripción *</label>
      <textarea
        id="descripcion"
        [(ngModel)]="proyecto.descripcion"
        name="descripcion"
        placeholder="Descripción detallada del proyecto"
        rows="4"
        [disabled]="isLoading"
        required
      ></textarea>
    </div>

    <div class="form-row">
      <div class="form-group">
        <label for="fechaAsignacion">Fecha de Asignación </label>
        <input
          type="text"
          id="fechaAsignacion"
          [(ngModel)]="proyecto.fechaAsignacion"
          name="fechaAsignacion"
          placeholder="26/1/2026"
          [disabled]="isLoading || isEdit"
          required
        />
      </div>

      <div class="form-group">
        <label for="fechaLimite">Fecha Límite </label>
        <input
          type="text"
          id="fechaLimite"
          [(ngModel)]="proyecto.fechaLimite"
          name="fechaLimite"
          placeholder="26/12/2026"
          [disabled]="isLoading"
          required
        />
      </div>
    </div>

    <div class="form-group select-room">
      <label>Asignar Trabajadores * (máx 3)</label>
      <div class="custom-select-wrapper select-compact-wrap">
        <button type="button" class="custom-select select-compact" (click)="toggleTrabajadoresDropdown()">
          {{ getTrabajadoresSeleccionadosLabel() }}
        </button>
        <div class="select-arrow">
          <svg width="16" height="16" viewBox="0 0 20 20" fill="currentColor">
            <path fill-rule="evenodd" d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z" clip-rule="evenodd"/>
          </svg>
        </div>
      </div>
      <div class="multi-select-panel" *ngIf="showTrabajadoresDropdown">
        <div class="multi-select-item" *ngFor="let trabajador of trabajadores">
          <label>
            <input
              type="checkbox"
              [checked]="isTrabajadorSeleccionado(trabajador.id)"
              (change)="toggleTrabajador(trabajador.id)"
            />
            <span>{{ trabajador.nombre }} {{ trabajador.apellido }} - {{ trabajador.cargo }}</span>
          </label>
        </div>
      </div>
    </div>

    <div class="form-group" *ngIf="isEdit">
      <label for="estado">Estado del Proyecto *</label>
      <div class="custom-select-wrapper select-compact-wrap">
        <select
          id="estado"
          [(ngModel)]="proyecto.estado"
          name="estado"
          class="custom-select select-compact"
          [disabled]="isLoading"
          required
        >
          <option *ngFor="let estado of estadoProyecto" [value]="estado">
            {{ estado.replace('_', ' ') }}
          </option>
        </select>
        <div class="select-arrow">
          <svg width="16" height="16" viewBox="0 0 20 20" fill="currentColor">
            <path fill-rule="evenodd" d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z" clip-rule="evenodd"/>
          </svg>
        </div>
      </div>
    </div>

    <div *ngIf="errorMessage" class="message message-error">
      <svg width="20" height="20" viewBox="0 0 20 20" fill="currentColor">
        <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z" clip-rule="evenodd"/>
      </svg>
      {{ errorMessage }}
    </div>

    <div *ngIf="successMessage" class="message message-success">
      <svg width="20" height="20" viewBox="0 0 20 20" fill="currentColor">
        <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"/>
      </svg>
      {{ successMessage }}
    </div>

    <div class="form-actions">
      <button type="button" (click)="cancel()" class="btn btn-secondary" [disabled]="isLoading">
        Cancelar
      </button>
      <button type="submit" class="btn btn-primary" [disabled]="isLoading">
        <span *ngIf="!isLoading">{{ isEdit ? 'Actualizar' : 'Crear Proyecto' }}</span>
        <span *ngIf="isLoading">Guardando...</span>
      </button>
    </div>
  </form>
</div>

<!-- Modal de Confirmación de Edición -->
<div *ngIf="showConfirmModal" class="modal-overlay" (click)="cancelConfirm()">
  <div class="modal-content modal-small modal-confirm" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <h2>Confirmar Cambios</h2>
      <button (click)="cancelConfirm()" class="close-btn">×</button>
    </div>
    <div class="modal-body">
      <p>¿Deseas guardar los cambios del proyecto?</p>
    </div>
    <div class="modal-footer">
      <button (click)="cancelConfirm()" class="btn btn-secondary">Cancelar</button>
      <button (click)="confirmEdit()" class="btn btn-primary">Confirmar</button>
    </div>
  </div>
</div>
